<p-toast></p-toast>

<div class="auth-container">
  <div class="auth-card">
    
    <!-- Header -->
    <div class="auth-header">
      <div class="auth-logo">
        <img src="assets/images/LOGO.png" alt="Logo" class="logo-img">
      </div>
      <h1 class="auth-title">Réinitialiser le mot de passe</h1>
      <p class="auth-subtitle">
        Créez un nouveau mot de passe sécurisé
      </p>
    </div>

    <!-- Vérification du token -->
    <div class="loading-card" *ngIf="checkingToken()">
      <i class="pi pi-spin pi-spinner"></i>
      <p>Vérification du lien...</p>
    </div>

    <!-- Token invalide -->
    <div class="error-card" *ngIf="!checkingToken() && !tokenValid()">
      <div class="error-icon">
        <i class="pi pi-times-circle"></i>
      </div>
      <h3 class="error-title">Lien invalide ou expiré</h3>
      <p class="error-text">
        Ce lien de réinitialisation n'est plus valide. Les liens expirent après 60 minutes.
      </p>
      <button 
        pButton 
        type="button"
        label="Faire une nouvelle demande"
        icon="pi pi-refresh"
        class="auth-button primary-button"
        (click)="goToForgotPassword()">
      </button>
    </div>

    <!-- Formulaire de réinitialisation -->
    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" *ngIf="!checkingToken() && tokenValid()">
      
      <!-- Nouveau mot de passe -->
      <div class="form-field">
        <label for="password" class="field-label">
          <i class="pi pi-lock"></i>
          Nouveau mot de passe
        </label>
        <p-password 
          id="password"
          formControlName="password"
          [feedback]="true"
          [toggleMask]="true"
          placeholder="Minimum 8 caractères"
          [inputStyle]="{ width: '100%' }"
          styleClass="w-full"
          [class.input-error]="f['password'].invalid && (f['password'].dirty || f['password'].touched)">
        </p-password>
        <small class="error-message" *ngIf="f['password'].errors?.['required'] && (f['password'].dirty || f['password'].touched)">
          <i class="pi pi-exclamation-circle"></i>
          Le mot de passe est requis
        </small>
        <small class="error-message" *ngIf="f['password'].errors?.['minlength'] && (f['password'].dirty || f['password'].touched)">
          <i class="pi pi-exclamation-circle"></i>
          Minimum 8 caractères requis
        </small>
      </div>

      <!-- Confirmation -->
      <div class="form-field">
        <label for="password_confirmation" class="field-label">
          <i class="pi pi-lock"></i>
          Confirmer le mot de passe
        </label>
        <p-password 
          id="password_confirmation"
          formControlName="password_confirmation"
          [feedback]="false"
          [toggleMask]="true"
          placeholder="Retapez le mot de passe"
          [inputStyle]="{ width: '100%' }"
          styleClass="w-full"
          [class.input-error]="f['password_confirmation'].invalid && (f['password_confirmation'].dirty || f['password_confirmation'].touched)">
        </p-password>
        <small class="error-message" *ngIf="f['password_confirmation'].errors?.['required'] && (f['password_confirmation'].dirty || f['password_confirmation'].touched)">
          <i class="pi pi-exclamation-circle"></i>
          La confirmation est requise
        </small>
        <small class="error-message" *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && f['password_confirmation'].touched">
          <i class="pi pi-exclamation-circle"></i>
          Les mots de passe ne correspondent pas
        </small>
      </div>

      <!-- Bouton -->
      <button 
        pButton 
        type="submit"
        label="Réinitialiser mon mot de passe"
        icon="pi pi-check"
        [loading]="isLoading()"
        [disabled]="resetPasswordForm.invalid || isLoading()"
        class="auth-button primary-button">
      </button>

    </form>

    <!-- Retour connexion -->
    <div class="auth-footer">
      <button 
        pButton 
        type="button"
        label="Retour à la connexion"
        icon="pi pi-arrow-left"
        class="p-button-text p-button-secondary"
        routerLink="/connexion">
      </button>
    </div>

  </div>
</div>